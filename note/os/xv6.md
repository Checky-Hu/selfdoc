xv6 note
======

## chapter0

### interfaces of os
- xv6 implements traditional kernel: a special process that provides service for any other processes;
- process contains: instructions, data and stack. Process in user space uses **system call** to enter kernel space and invokes kernel service.

### process and memory
- xv6 process contains two parts: memory in user space(instructions, data and stack) and process status in kernel spaceï¼›
- xv6 saves the cpu registers for process that isn't running and recover those values when it goes back to running state;
- xv6 uses ELF(Executable and Linking Format);
- `sh.c` implements shell.

### I/O and file descriptor
- file descriptor is an integer that represent an object managed by kernel in process, or simply called `file`;
- each process has its own file descriptor table. `0` means `stdin`, `1` means `stdout`, `2` means `stderr`;
- file descriptor generated by `fork()` and `dup()` share the same offset in one file.

### pipe
- pipe is a pair of file descriptors that represent a small buffer in kernel;
- pipe is different from temp file: self-clean by read and write, no limit for data size and synchronized.

### file system
- file system includes files and directories;
- `mknod()` create a device. A major and minor number together confirm an unique kernel device;
- `stat.h` defines file struct;
- plan 9 implements "everything is file".

## chapter1

### overview of process
- xv6 uses page table that implemented by hardware to provide address space for each process. Page table translates virtual address that used by x86 instruction set to physical address that used by cpu and memory;
- layout of process virtual address space: 0 -> user text -> user data -> user stack -> heap -> |0x80000000| BIOS |0x80100000| -> kernel text -> kernel data -> free memory -> 0xFFFFFFFF;
- `proc.h` defines process struct;
- when running user text, all kernel space is empty; when running kernel text, all user space keeps same but inactive;
- process start system call -> cpu jump to kernel space -> hardware privilege level up -> finish system call -> hardware privilege level down -> cpu jump back to user space(process may block in kernel space and wait for I/O);

### first address space

### create first process

### execute first process

### first system call: `exec`

## appendix-a

### hardware of personal computer
- personal computer contains: CPU, Memory, I/O devices;
- cpu bus contains: Address Bus, Data Bus, Control Bus.

### cpu and memory

#### common registers
- x86 instruction set contains 8 32-bits common registers: %eax, %ebx, %ecx, %edx, %edi, %esi, %ebp, %esp; and 1 instruction pointer register: %eip;
- `e` means `extended`. So there is 8 16-bits common registers too: %ax, %bx, %cx, %dx, %di, %si, %bp, %sp;
- for `%|a-d|x`, there are 2 8-bits common registers for each, such as: %al(low bits) and %ah(high bits) for %ax.

#### float registers
- x86 instruction set contains 8 80-bits float registers.

#### control registers
- x86 instruction set contains 4 control registers: %cr0, %cr2, %cr3, %cr4.(%cr1 is reserved)

#### debug registers
- x86 instruction set contains 4 debug registers: %dr0, %dr1, %dr2, %dr3.

#### segment registers
- x86 instruction set contains 6 segment registers: %cs, %ds, %es, %fs, %gs, %ss.

#### global/local descriptor table registers
- x86 instruction set contains: %gdtr, %ldtr.

### I/O
- x86 instruction set contains `in, out` for I/O devices' read and write;
- modern x86 use `memory mapped I/O` for interacting with I/O devices just like memory.

## appendix-b

### boot loader
- x86 PC starts with BIOS that prepares hardware and gives the right of control to boot sector(512B data area on the disk). Boot sector contains boot loader that load kernel to memory;
- BIOS load boot sector to memory 0x7c00 and then set %ip to this address. When boot loader starts, cpu is under Intel 8088 cpu mode. Boot loader set cpu to modern operating mode and load kernel from disk to memory;
- xv6 boot loader contains two source files: `bootasm.S` written by 16&32 bits asm, and `bootmain.c` written by c.

### asm boot program

### C boot program

### in reality


